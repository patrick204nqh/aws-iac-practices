# SSH Access Guide

> **ğŸ¯ TIP:** Use `terraform output ssh_commands` for ready-to-use SSH commands with IPs automatically filled in!

## ğŸš€ **Simple Connection (Recommended)**

Use Terraform outputs to get the SSH commands:

```bash
# Get all SSH commands with IPs automatically filled in
terraform output ssh_commands

# Copy and paste the desired command from the output
```

## ğŸ“‹ **Manual Commands (If Needed)**

If you prefer manual commands, get the current IPs first:

```bash
# Get current IPs
terraform output bastion_public_ip
terraform output database_private_ip
# Note: webapp is in public subnet but accessed via bastion for security
```

Then use these commands:

```bash
# Direct bastion connection
ssh -i ./market-practice-key.pem ubuntu@<bastion_public_ip>

# Webapp via bastion (jump host)
ssh -i ./market-practice-key.pem \
  -o ProxyCommand="ssh -i ./market-practice-key.pem -o StrictHostKeyChecking=no -W %h:%p ubuntu@<bastion_public_ip>" \
  -o StrictHostKeyChecking=no ubuntu@<webapp_private_ip>

# Database via bastion (jump host)  
ssh -i ./market-practice-key.pem \
  -o ProxyCommand="ssh -i ./market-practice-key.pem -o StrictHostKeyChecking=no -W %h:%p ubuntu@<bastion_public_ip>" \
  -o StrictHostKeyChecking=no ubuntu@<database_private_ip>
```

## ğŸ”‘ **SSH Key Location**

- Key file: `./market-practice-key.pem` (auto-generated by Terraform)
- Permissions: Already set to 600 by Terraform

## ğŸŒ **Network Layout**

- **Bastion**: Public subnet in management VPC (10.1.0.0/16)
- **Webapp**: Public subnet in app VPC (10.2.0.0/16) 
- **Database**: Private subnet in app VPC (10.2.0.0/16)
- **VPC Peering**: Enabled between management and app VPCs (staging only)

## ğŸ› ï¸ **Troubleshooting**

### Connection Issues:
1. Make sure you're in the correct directory with Terraform state
2. Verify infrastructure is deployed: `terraform output`
3. Check if instances are running: `aws ec2 describe-instances`

### Why not use `ssh -J`?
The `-J` (ProxyJump) option has limitations with key handling when using the same key for both jump host and target. Our ProxyCommand approach is more reliable.

## ğŸ“– **Two-Step Method (Alternative)**

If you prefer the traditional approach:

```bash
# Step 1: SSH to bastion
ssh -i ./market-practice-key.pem ubuntu@<bastion_public_ip>

# Step 2: From bastion, SSH to targets
ssh ubuntu@<webapp_private_ip>    # webapp
ssh ubuntu@<database_private_ip>  # database
```

This requires copying the SSH key to bastion first.